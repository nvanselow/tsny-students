!function(){"use strict";angular.module("TsnyConstants",[])}(),function(){"use strict";angular.module("TsnyControllers",[])}(),function(){"use strict";angular.module("TsnyServices",[])}(),function(){"use strict";angular.module("TsnyApp",["ngMaterial","ui.router","ngMessages","TsnyControllers","TsnyConstants","TsnyServices"]).config(["$mdThemingProvider","$urlRouterProvider","$stateProvider","$httpProvider",function(t,n,e,o){t.theme("default").primaryPalette("blue").accentPalette("amber").warnPalette("red"),n.otherwise("/"),e.state("home",{url:"/",templateUrl:"views/students.html",controller:"SchoolsController as SchoolsCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"AuthController as AuthCtrl"}).state("add_student",{url:"/schools/{school_id}/add-student",templateUrl:"views/add_student.html",controller:"AddStudentController as StudentCtrl",resolve:{schools:["School",function(t){return t.all().then(function(t){return t})}]}}).state("student_details",{url:"/student/{student_id}",templateUrl:"views/student_details.html",controller:"StudentController as StudentCtrl",resolve:{details:["Student","$stateParams",function(t,n){return t.details(n.student_id).then(function(t){return t})}]}}),o.interceptors.push("ApiInterceptor")}])}(),function(){"use strict";angular.module("TsnyControllers").controller("AuthController",["Auth","$state",function(t,n){var e=this;e.user={email:"",password:"",remember:!0},e.login=function(){t.login(e.user).then(function(t){n.go("home")})},e.logout=function(){t.logout()}}])}(),function(){"use strict";angular.module("TsnyConstants").constant("_",window._)}(),function(){"use strict";angular.module("TsnyServices").service("ApiInterceptor",["$window",function(t){var n={};return n.responseError=function(n){return 401===n.status&&(console.log("not logged in."),t.location.href="/auth/login"),403==n.state&&(console.log("unauthorized for that action"),t.location.href="/auth/login"),n},n}])}(),function(){"use strict";angular.module("TsnyServices").service("Auth",["$http","$window",function(t,n){var e={};return e.login=function(n){return t.post("api/login",{user:n})},e.logout=function(){return t.get("/auth/logout").then(function(t){n.location.href="/auth/login"},function(t){})},e}])}(),function(){"use strict";angular.module("TsnyServices").service("Goal",["$http","$mdDialog","$q",function(t,n,e){var o={};return o.addGoal=function(t){var l=e.defer();return n.show({controller:"AddGoalDialogController as GoalCtrl",templateUrl:"views/goal_dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{student:t}}).then(function(t){o.postGoal(t.student,t.goal).then(function(t){return l.resolve(t),t},function(t){return l.reject(null),null})},function(){l.reject(null)}),l.promise},o.postGoal=function(n,o){return t.post("api/student/"+n.id+"/goal",{goal:o}).then(function(t){return t.data.goal},function(t){e.reject(null)})},o.toggleGoal=function(n){return t.post("api/goal/"+n.id+"/toggle",{}).then(function(t){return n.complete=t.data.complete,n},function(t){return t})},o}]).controller("AddGoalDialogController",["$mdDialog","student",function(t,n){var e=this;e.student=n,e.goal={description:"",complete:!1},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.save=function(){t.hide({student:e.student,goal:e.goal})}}])}(),function(){"use strict";angular.module("TsnyServices").service("Note",["$http","$mdDialog","$q",function(t,n,e){var o={};return o.addNote=function(t){var l=e.defer();return n.show({controller:"AddNoteDialogController as NoteCtrl",templateUrl:"views/note_dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{student:t}}).then(function(t){o.postNote(t.student,t.note).then(function(t){return l.resolve(t),t},function(t){return l.reject(null),null})},function(){l.reject(null)}),l.promise},o.postNote=function(n,o){return t.post("api/student/"+n.id+"/note",{note:o}).then(function(t){return t.data.note},function(t){e.reject(null)})},o}]).controller("AddNoteDialogController",["$mdDialog","student",function(t,n){var e=this;e.student=n,e.note={note:""},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.save=function(){t.hide({student:e.student,note:e.note})}}])}(),function(){"use strict";angular.module("TsnyServices").service("School",["$http","$q",function(t,n){var e={};return e.schools=[],e.students=[],e.all=function(o){var l=n.defer();return!o&&e.schools&&e.schools.length?(console.log("schools already exist"),l.resolve(e.schools),l.promise):(t.get("api/schools").then(function(t){e.schools=t.data,l.resolve(t.data)},function(t){console.log("Error!"),console.log(t),e.schools=[],l.reject([])}),console.log("got schools from http"),l.promise)},e.updateStudents=function(n){return t.get("api/schools/"+n+"/students").then(function(t){return e.students=t.data,t.data},function(t){return console.log("error obtaining students for this school."),e.students=[],[]})},e.updateStudentsWithSummaries=function(n){return t.get("api/schools/"+n+"/students/summaries").then(function(t){return e.students=t.data,t.data},function(t){return console.log("error obtaining students for this school."),e.students=[],[]})},e}])}(),function(){"use strict";angular.module("TsnyServices").service("Skill",["$http","$mdDialog","$q",function(t,n,e){var o={};return o.addSkill=function(t){var l=e.defer();return n.show({controller:"AddSkillDialogController as SkillCtrl",templateUrl:"views/skill_dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{student:t}}).then(function(t){o.postSkill(t.student,t.skill).then(function(t){return l.resolve(t),t},function(t){return l.reject(null),null})},function(){l.reject(null)}),l.promise},o.postSkill=function(n,o){return t.post("api/student/"+n.id+"/skill",{skill:o}).then(function(t){return t.data.skill},function(t){e.reject(null)})},o.toggleCurrentSkill=function(n){return t.post("api/skill/"+n.id+"/toggle",{}).then(function(t){return n.current=t.data.current,n},function(t){return t})},o}]).controller("AddSkillDialogController",["$mdDialog","student",function(t,n){var e=this;e.student=n,e.skill={name:"",proficiency:0,current:!1,note:""},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.save=function(){t.hide({student:e.student,skill:e.skill})}}])}(),function(){"use strict";angular.module("TsnyServices").service("Student",["$http","$q",function(t,n){var e={};return e.create=function(n){return t.post("api/student",{student:n})},e.details=function(n){return t.get("api/student/"+n).then(function(t){return{student:t.data.student,goals:t.data.details.goals,skills:t.data.details.skills,notes:t.data.details.notes}},function(t){return null})},e.search=function(e){var o=n.defer();return e&&e.length?t.get("api/student/search/"+e).then(function(t){o.resolve(t.data)},function(t){o.reject(t)}):o.reject([]),o.promise},e}])}(),function(){"use strict";angular.module("TsnyServices").service("UserInfo",["Auth",function(t){var n={};return n.current_school={id:1,name:"Boston"},n.logout=function(){t.logout()},n}])}(),function(){"use strict";angular.module("TsnyControllers").controller("StudentController",["Student","Note","Goal","Skill","$state","details",function(t,n,e,o,l,s){var r=this;r.student=s.student,r.goals=s.goals,r.skills=s.skills,r.notes=s.notes,r.addNote=function(){n.addNote(r.student).then(function(t){r.notes.unshift(t)})},r.addGoal=function(){e.addGoal(r.student).then(function(t){r.goals.unshift(t)})},r.addSkill=function(){o.addSkill(r.student).then(function(t){r.skills.unshift(t)})},r.ToggleGoal=function(t){e.toggleGoal(t)},r.ToggleCurrentSkill=function(t){o.toggleCurrentSkill(t)}}]).controller("AddStudentController",["$stateParams","schools","Student","$state",function(t,n,e,o){var l=this;l.schools=n,l.student={first_name:"",last_name:"",nickname:"",email:"",primary_school:t.school_id,schools:[Number(t.school_id)]},l.change_primary_school=function(){var t=Number(l.student.primary_school);l.school_exists_in_list(t)||l.student.schools.push(t)},l.toggle_school=function(t){var n=l.student.schools,e=t;if(e!=l.student.primary_school){var o=n.indexOf(e);o>-1?n.splice(o,1):n.push(e)}},l.school_exists_in_list=function(t){var n=l.student.schools,e=t;return n.indexOf(e)>-1},l.adding_student=!1,l.addStudent=function(){l.adding_student=!0,e.create(l.student).then(function(t){o.go("home")},function(t){})["finally"](function(){l.adding_student=!1})},l.cancel=function(){o.go("home")}}])}(),function(){"use strict";angular.module("TsnyControllers").controller("SchoolsController",["UserInfo","School","Note","Student","$state",function(t,n,e,o,l){var s=this;s.user_info=t,s.loading=!0,s.School=n,s.loading_students=!1,n.all()["finally"](function(){s.loading=!1}),s.school_changed=function(){s.user_info.current_school.name=_.find(s.School.schools,function(t){return t.id==s.user_info.current_school.id}).name,s.update_student_list(s.user_info.current_school.id)},s.update_student_list=function(t){s.loading_students=!0,n.updateStudentsWithSummaries(t)["finally"](function(){s.loading_students=!1})},s.addNote=function(t){e.addNote(t).then(function(n){t.summary.most_recent_notes.unshift(n)},function(t){})},s.user_info.current_school&&s.update_student_list(s.user_info.current_school.id),s.selected_student=null,s.student_search_results=[],s.student_search_text="",s.SearchForStudent=function(t){o.search(t).then(function(t){return s.student_search_results=t,t})},s.SelectedStudentChanged=function(t){t&&(l.go("student_details",{student_id:t.id}),s.student_search_text="",s.selected_student=null)}}])}();